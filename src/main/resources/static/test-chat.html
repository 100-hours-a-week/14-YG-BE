<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<button onclick="connect()">Connect</button>
<button onclick="sendMessage()">Send Message</button>

<script>
    // ì‚¬ìš©ìê°€ ì›í•˜ëŠ” postIdì™€ aliasIdë¥¼ ì„¤ì •
    const postId = 1;     // í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥
    const aliasId = 1;    // í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥

    let stompClient = null;

    // STOMP ì—°ê²° í•¨ìˆ˜
    function connect() {
        // ì›¹ì†Œì¼“ ì—°ê²° ì‹œì‘ (Spring WebSocket ì—”ë“œí¬ì¸íŠ¸ì— ì—°ê²°)
        const socket = new WebSocket("ws://localhost:8080/ws/chat");

        // STOMP í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        stompClient = Stomp.over(socket);

        // STOMP ì—°ê²° ì‹œë„
        stompClient.connect({}, frame => {
            console.log('âœ… Connected to STOMP server. Frame:', frame);

            // ì„œë²„ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ë°›ì„ ê²½ë¡œ êµ¬ë…
            stompClient.subscribe(`/sub/chat/${postId}`, message => {
                console.log('ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ ë¨:', message.body);
            });

            console.log(`ğŸ“¡ êµ¬ë… ì™„ë£Œ: /sub/chat/${postId}`);

        }, error => {
            console.error('âŒ Connection error:', error);
        });
    }

    // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
    function sendMessage() {
        if (!stompClient || !stompClient.connected) {
            console.warn("âš ï¸ STOMP ì—°ê²°ì´ ë˜ì–´ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ë¨¼ì € Connect ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.");
            return;
        }

        // ì „ì†¡í•  ë©”ì‹œì§€ ë‚´ìš© ì •ì˜ (aliasIdëŠ” ì‹¤ì œ ì•±ì—ì„œëŠ” ì„œë²„ì—ì„œ ë°›ì€ ê°’ì„ ì‚¬ìš©)
        const payload = {
            postId: postId,
            aliasId: aliasId,
            message: "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤."
        };

        // ì„œë²„ë¡œ ë©”ì‹œì§€ ì „ì†¡
        stompClient.send(`/pub/chat/${postId}`, {}, JSON.stringify(payload));
        console.log('ğŸš€ ë©”ì‹œì§€ ì „ì†¡ë¨:', payload);
    }
</script>
</body>
</html>